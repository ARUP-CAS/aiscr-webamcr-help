{
  "hash": "3c9be2c897daac810355f46e25dff056",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"AMČR API\"\nsubtitle: \"Uživatelská příručka\"\ndate: 2020-06-01\ndate-format: D. M. YYYY\n---\n\n\nAPI v současné době nabízí službu *AMCR Data Provider*, která poskytuje metadatové záznamy z databáze AMČR, a to pomocí protokolu *OpenArchives Initiative Protocol for Metadata Harvesting* ([OAI-PMH](http://www.openarchives.org/pmh/){.external}).\n\nNaše implementace protokolu OAI-PMH podporuje\n reprezentaci metadat ve standardech:\n\n- [Dublin Core](http://dublincore.org/){.external} -- poskytuje část datasetu týkající se dokumentů a jejich popisu;\n- [~~CIDOC-CRM~~](http://www.cidoc-crm.org/){.external} -- nabízí archivovaná, volně přístupná data z AMČR ve formátu RDF v syntaxi odpovídající této ontologii;\n- **AMČR XML** -- nativní formát, který umožňuje plné vytěžování databáze při zohlednění přístupových práv.\n\n[Uživatelé](role.qmd) s vyšším oprávněním mohou využít své přihlašovací údaje do AMČR pro přístup k nearchivovaným či jinak chráněným záznamům.\nAktualizace dat probíhá na denní bázi.\n\nAPI najdete na adrese [https://api.aiscr.cz](https://api.aiscr.cz){.external}.\n\n[![Poster prezentující API s příklady možných requestů [@pajdla2021a]](figs/api_liseh.png){width=60% fig-align=\"center\" #fig-api-poster}](https://gams.uni-graz.at/o:liseh.8112/PDF_STREAM)\n\n## Technické řešení\n\n![OAI-PMH API a služba AMCR Data Provider](figs/api-schema.png){#fig-api width=80% align=\"center\"}\n\nArchitektura API se skládá z 5 komponent: *AMCR Filter*, *RDF Converter*, *Scrub*, *AMCR Pass* a *AMCR Data Provider*.\nVšechny komponenty jsou napsány v jazyce Java.\n~~Řešení používá open-source projekt X3ML Engine pro konverzi XML na RDF.~~\n\n![Schéma celkového řešení API](figs/api-reseni.png){#fig-api-reseni}\n\n![Schéma databáze s dílčími datovými sety](figs/api-sety.png){#fig-api-sety}\n\n### Řešení filtrace\n\n#### Stav a přístupnost záznamu\n\nPřístupnost záznam je ovlivněna jak [procesními stavy](procesy.qmd) daných metadatových záznamů, tak [uživatelskou rolí](role.qmd).\n\n![Schéma přístupnosti záznamů dle uživatelských rolí](figs/api-pristupnost.png){#fig-api-pristupnost}\n\n#### Sety\n\nSelektivní výběr je umožněn pomocí nadefinovaných setů, viz také @fig-api-sety.\n\n\n::: {#tbl-api-sets .cell tbl-cap='Sety'}\n::: {.cell-output-display}\n\n\n|setSpec          |setName                                                             |\n|:----------------|:-------------------------------------------------------------------|\n|projekt          |Projekty / Projects                                                 |\n|akce             |Akce / Fieldwork Events                                             |\n|lokalita         |Lokality / Sites                                                    |\n|dok_jednotka     |Dokumentační jednotky / Descriptive Units                           |\n|adb              |Archeologický dokumentační bod / Archaeological Documentation Point |\n|dokument         |Dokumenty / Documents                                               |\n|soubor           |Soubory / Files                                                     |\n|pian             |PIAN / Spatial Units                                                |\n|ext_zdroj        |Externí zdroje / External Sources                                   |\n|let              |Lety / Flights                                                      |\n|samostatny_nalez |Samostatné nálezy / Individual Finds                                |\n\n\n:::\n:::\n\n\n#### Datestamps\n\nPro dotazy `ListRecords` a `ListIdentifiers` je umožněno filtrování na základě volitelného argumentu\n`datestamp` (from – od, until – do), kdy `datestamp` je vždy nejmladší z dostupných datumů.\n\n![Specifikace nastavení `datestamp` pro jednotlivé záznamy](figs/api-datestamps.png){#fig-api-datestamps}\n\nAMČR nepodporuje evidenci smazaných záznamů.\nPo smazání záznamu z databáze proto dojde k odstranění záznamu z API bez náhrady ve formě hlavičky smazaného záznamu (`status=\"deleted\"`).\nNěkteré operace se v AMČR se nemusí projevit změnou `datestamp` v API.\nDůvodem je způsob logování změn, který se váže pouze na specifické operace (změna [stavu](procesy.qmd) záznamu).\nPři využití API proto doporučujeme data pravidelně obnovovat, nebo umožnit uživateli vynucenou aktualizaci konkrétního záznamu.\nPodpora úplného sledování změn bude implementována v budoucích verzích API po provedení nutných úprav v databázi AMČR\n\n## Přihlášení\n\nPokud chcete pro stahování dat používat svůj účet AMČR, je nutné přihlášení pomocí Basic access authentication.\nProtokol https zajišťuje bezpečnou komunikaci.\nZpůsob přihlášení se liší v každém nástroji, který je pro stahování dat používán.\nNíže jsou detailněji popsány způsoby přihlášení pro *cURL* a *Postman*.\n\n### cURL\n\ncURL je nástroj skládající se ze softwarové knihovny (libcurl) a z nástroje příkazového řádku (curl) sloužících ke stahování souborů přes počítačovou síť.\nNástroj je dostupný pro různé operační systémy Linux, macOS a Windows.\nSvé uživatelské jméno a heslo je možné zadat pomocí přepínače -u.\n\n```\ncurl -u username:password <GET request>\n```\n\nPřihlašovací údaje je nutné posílat v každém requestu.\n\n### Postman\n\nPostman je multiplatformní aplikace pro vývojáře sloužící k návrhu a interakci s HTTP API.\nUživatelské jméno a heslo lze zadávat na kartě *Autorizace*.\nV rozevírací nabídce *TYPE* zvolte možnost *Basic Auth* a stiskněte tlačítko *Odeslat*.\nPřihlašovací údaje jsou poté posílány automaticky v každém requestu.\n\n## Verbs\n\nDotazování v protokolu OAI-PMH je možné pomocí tzv. sloves (verbs).\nVýznam jednotlivých sloves s příkladem užití jsou popsány v následujících kapitolách.\nPodrobná specifikace protokolu OAI-PMH je k dispozici [zde](http://www.openarchives.org/OAI/openarchivesprotocol.html){.external}.\n\n### Identify\n\nSloveso `Identify` se používá k získání informací o úložišti.\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=Identify](https://api.aiscr.cz/dapro/oai?verb=Identify){.external}\n\n### ListMetadataFormats\n\nSloveso `ListMetadataFormats` se používá k načtení formátů metadat dostupných z úložiště.\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=ListMetadataFormats](https://api.aiscr.cz/dapro/oai?verb=ListMetadataFormats){.external}\n\nOdpověď:\n\n::: {.small}\n\n```xml\n<OAI-PMH xsi:schemaLocation=\"http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd\">\n  <responseDate>2023-07-10T14:10:00Z</responseDate>\n  <request verb=\"ListMetadataFormats\">https://api.aiscr.cz/dapro/oai</request>\n  <ListMetadataFormats>\n    <metadataFormat>\n      <metadataPrefix>oai_dc</metadataPrefix>\n      <schema>http://www.openarchives.org/OAI/2.0/oai_dc.xsd</schema>\n      <metadataNamespace>http://www.openarchives.org/OAI/2.0/oai_dc/</metadataNamespace>\n    </metadataFormat>\n    <metadataFormat>\n      <metadataPrefix>oai_rdf</metadataPrefix>\n      <schema>https://api.aiscr.cz/dapro/media/oai_rdf.xsd</schema>\n      <metadataNamespace>https://api.aiscr.cz/schema/oai_rdf/</metadataNamespace>\n    </metadataFormat>\n     <metadataFormat>\n      <metadataPrefix>oai_amcr</metadataPrefix>\n      <schema>https://api.aiscr.cz/dapro/media/oai_amcr.xsd</schema>\n      <metadataNamespace>https://api.aiscr.cz/schema/oai_amcr/</metadataNamespace>\n    </metadataFormat>\n  </ListMetadataFormats>\n</OAI-PMH>\n```\n\n:::\n\nImplementace OAI-PMH podporuje reprezentaci metadat v:\n\n- Dublin Core – `metadataPrefix` `oai_dc`,\n- ~~CIDOC-CRM – `metadataPrefix` `oai_rdf`,~~\n- interním AMČR XML – `metadataPrefix` `oai_amcr`.\n\nJednotlivá schémata jsou k dispozici na: https://api.aiscr.cz/dapro/media/*.xsd.\n\n### ListIdentifiers\n\nSloveso `ListIdentifiers` se používá pro načtení záhlaví záznamů (header) z úložiště.\nPovinným argumentem je `metadataPrefix`.\nNepovinné argumenty umožňují filtraci záhlaví na základě nastavených [setů](api.qmd#sety) a/nebo [datestamp](api.qmd#datestamps).\nUživatel dostane v odpovědi první stránku se záhlavím záznamů.\nPro načtení dalších stránek je nutné použit [`resumptionToken`](api.qmd#resumptionToken).\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=ListIdentifiers&metadataPrefix=oai_amcr](https://api.aiscr.cz/dapro/oai?verb=ListIdentifiers&metadataPrefix=oai_amcr){.external}\n\n### ListRecords\n\nSloveso `ListRecords` se používá pro načtení záznamů z úložiště.\nPovinným argumentem je `metadataPrefix`.\nNepovinné argumenty umožňují filtraci záznamů na základě nastavených [setů](api.qmd#sety) a/nebo [datestamp](api.qmd#datestamps).\nUživatel dostane v odpovědi první stránku se záznamy.\nPro načtení dalších stránek je nutné použit [`resumptionToken`](api.qmd#resumptionToken).\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=ListRecords&metadataPrefix=oai_amcr](https://api.aiscr.cz/dapro/oai?verb=ListRecords&metadataPrefix=oai_amcr){.external}\n\nOdpověď:\n\n::: {.small}\n\n```xml\n<OAI-PMH xsi:schemaLocation=\"http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd\">\n  <responseDate>2023-07-11T07:21:17Z</responseDate>\n  <request verb=\"ListRecords\" metadataPrefix=\"oai_amcr\">https://api.aiscr.cz/dapro/oai</request>\n  <ListRecords>\n    <record>\n      <header>\n        <identifier>https://api.aiscr.cz/id/C-201773056</identifier>\n        <datestamp>2022-06-09</datestamp>\n        <setSpec>projekt</setSpec>\n      </header>\n      <metadata>\n        <oai_amcr:amcr xsi:schemaLocation=\"https://api.aiscr.cz/schema/oai_amcr https://api.aiscr.cz/dapro/media/oai_amcr.xsd\">\n          <projekt>\n            <ident_cely>C-201773056</ident_cely>\n            <stav>6</stav>\n            <typ_projektu>záchranný</typ_projektu>\n            <datetime_born>2016-01-01 00:00:00</datetime_born>\n            <okres>PLZEŇ-SEVER</okres>\n            (...)\n            <termin_odevzdani_nz>2019-12-30</termin_odevzdani_nz>\n            <child_akce>C-201773056A</child_akce>\n          </projekt>\n        </oai_amcr:amcr>\n      </metadata>\n    </record>\n    <resumptionToken cursor=\"0\" expirationDate=\"2023-07-12T22:30:00Z\">2023-07-10.oai_amcr.1000.projekt.1000.1000...f</resumptionToken>\n  </ListRecords>\n</OAI-PMH>\n```\n\n:::\n\n### GetRecord\n\nSloveso `GetRecord` se používá k získání individuálního záznamu metadat z úložiště.\nPožadované argumenty jsou `metadataPrefix` a identifikátor položky (`identifier`), ze které je záznam požadován.\nPoložky jednotlivých setů nesou v hlavičce persistentní identifikátory, odvozované z pole *ident_cely* u jednotlivých záznamů nejvýše v XML struktuře záznamu v daném setu.\nVýjimkou je set soubor, kde jako identifikátor slouží pole `filepath`.\nK základnímu formátu identifikátoru je vždy jako prefix připojena URL: `https://api.aiscr.cz/id/`.\nOdkazy mezi záznamy napříč sety jsou řešeny na úrovni základního identifikátoru bez prefixu.\nDalší informace ke struktuře identifikátorů a vazbám naleznete v samostatné [kapitole](identifikatory.qmd).\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=GetRecord&identifier=https://api.aiscr.cz/id/C-DL-200400001&metadataPrefix=oai_amcr](https://api.aiscr.cz/dapro/oai?verb=GetRecord&identifier=https://api.aiscr.cz/id/C-DL-200400001&metadataPrefix=oai_amcr){.external}\n\nOdpověď:\n\n::: {.small}\n\n```xml\n<OAI-PMH xsi:schemaLocation=\"http://www.openarchives.org/OAI/2.0/ http://www.openarchives.org/OAI/2.0/OAI-PMH.xsd\">\n  <responseDate>2023-07-11T07:37:18Z</responseDate>\n  <request verb=\"GetRecord\" metadataPrefix=\"oai_amcr\" identifier=\"https://api.aiscr.cz/id/C-DL-  200400001\">https://api.aiscr.cz/dapro/oai</request>\n  <GetRecord>\n    <record>\n      <header>\n        <identifier>https://api.aiscr.cz/id/C-DL-200400001</identifier>\n        <datestamp>2018-06-15</datestamp>\n        <setSpec>dokument</setSpec>\n      </header>\n      <metadata>\n        <oai_amcr:amcr xsi:schemaLocation=\"https://api.aiscr.cz/schema/oai_amcr https://api.aiscr.cz/dapro/media/oai_amcr.xsd\">\n          <dokument>\n            <ident_cely>C-DL-200400001</ident_cely>\n            <let>C-LET-00253</let>\n            (...)\n            <jednotka_dokumentu>\n              <ident_cely>C-DL-200400001-D01</ident_cely>\n              (...)\n              <komponenta_dokument>\n                <ident_cely>C-DL-200400001-K01</ident_cely>\n                <parent>C-DL-200400001-D01</parent>\n                <obdobi>pr.zem</obdobi>\n                <areal>sídliště nesp.</areal>\n                <aktivita_sidlistni>1</aktivita_sidlistni>\n                <aktivita_pohrebni>0</aktivita_pohrebni>\n                (...)\n                <nalez_dokumentu>\n                  (...)\n                </nalez_dokumentu>\n              </komponenta_dokument>\n            </jednotka_dokumentu>\n          </dokument>\n        </oai_amcr:amcr>\n      </metadata>\n    </record>\n  </GetRecord>\n</OAI-PMH>\n```\n\n:::\n\n### ListSets\n\nSloveso `ListSets` se používá k načtení nastavené struktury úložiště, tzv. setů.\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=ListSets](https://api.aiscr.cz/dapro/oai?verb=ListSets){.external}\n\n## Parametry\n\n### Stránkování\n\nPomocí sloves uživatel získává první stránku požadovaných metadat.\nPro získání dalších záznamů je nutné použit parametr `resumptionToken`, který uživatel dostal v odpovědi na svůj dotaz.\nParametr `resumptionToken` je vždy na konci odpovědi.\nPočet záznamů na stránku je dán konfigurací na straně poskytovatele API.\n\nOdpověď na dotaz v sekci [ListRecords](api.qmd#listrecords) vrátila následující XML element obsahující `resumptionToken`, který je použit v dalším dotazu:\n\n```xml\n<resumptionToken cursor=\"0\" expirationDate=\"2023-07-12T22:30:00Z\">\n  2023-07-10.oai_amcr.1000.projekt.1000.1000...f\n</resumptionToken>\n```\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=ListIdentifiers&resumptionToken=2023-07-10.oai_amcr.1000.projekt.1000.1000...f](https://api.aiscr.cz/dapro/oai?verb=ListIdentifiers&resumptionToken=2023-07-10.oai_amcr.1000.projekt.1000.1000...f){.external}\n\nParametr `resumptionToken` je v tomto případě společně se slovesy `ListRecords` a `ListIndentifiers`\nvýhradním parametrem.\n\n### Filtrování\n\nTzv. selektivní sklizeň umožňuje uživatelům omezit požadavky na sběr dat na části metadat dostupných z úložiště.\nOAI-PMH podporuje selektivní sklizeň se dvěma typy kritérií pro sklizeň, která mohou být kombinována: `datestamp` a `set`.\nData provider AMČR navíc uživatelům filtruje záznamy podle jejich přístupnosti.\n\n#### Podle přístupnosti záznamu\n\nPři zpracování dotazu jsou uživateli automaticky záznamy filtrovány podle přístupnosti, která je nadefinovaná v AMČR.\nAnonymní uživatel má vždy přístupnost pouze k archivovaným záznamům.\nArcheologové či uživatelé s vyšším oprávněním mají přístup i k nearchivovaným či jinak chráněným záznamům.\nVice viz kapitoly k [procesním stavům](procesy.qmd) a [uživatelským rolím](role.qmd).\n\n#### Pomocí Setů\n\nProtokol OAI-PMH umožňuje filtrování pomocí nadefinovaných setů, a to přidáním parametru `set`.\nPomocí slovesa `ListSets` je možné získat hodnotu `setSpec` pro všechny nadefinované [sety](api.qmd#sety), viz také @fig-api-sety.\nPro zvolené filtrování se poté do requestu se slovesy `ListRecords` nebo `ListIndentifiers` přidává parametr `set=setSpec`.\nFiltrování pomocí setů lze kombinovat s filtrováním pomocí `datestamp`.\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=ListRecords&set=akce&metadataPrefix=oai_amcr](https://api.aiscr.cz/dapro/oai?verb=ListRecords&set=akce&metadataPrefix=oai_amcr){.external}\n\n#### Pomocí datestamp\n\nProtokol OAI-PMH umožňuje filtrování pomocí datumu (`datestamp`), přiřazeného ke každému záznamu.\nPro požadované filtrování se poté do requestu se slovesy `ListRecords` nebo `ListIndentifiers` přidává parametr `from` (od) a/nebo `until` (do).\n\nDotaz: [https://api.aiscr.cz/dapro/oai?verb=ListIdentifiers&metadataPrefix=oai_amcr&from=2022-12-10&until=2022-12-20](https://api.aiscr.cz/dapro/oai?verb=ListIdentifiers&metadataPrefix=oai_amcr&from=2022-12-10&until=2022-12-20){.external}\n\n",
    "supporting": [
      "api_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}